# 3주차
---

### **송출한 패킷이 네트워크 기기를 경유하여 인터넷을 향해**

## 1. LAN(Local Area Network) 이란?

**근거리 통신망** 을 뜻하며 집, 학교 같은 제한된 공간 내에서 컴퓨터, 프린터 등 다양한 장치들을 연결하는 네트워크이다.

일반적으로 이더넷 케이블이나 WI-FI를 통해 연결되고, 빠르고 안정적인 데이터 전송을 제공

- 패킷이 LAN을 통해 전송되는 과정
    1. 브라우저에게 메시지 생성
        - 사용자가 웹사이트에 접속하여 데이터를 요청하면, 브라우저는 메시지를 생성한다.(여기서 메시지는 HTML요청, 이미지 요청 등)
    2. 프로토콜 스택이 메시지 수신
        - 운영체제에 내장된 **프로토콜 스택(TCP/IP)** 이 메시지를 받아 처리하며 이 스택은 응용계층→전송계층→인터넷계층→네트워크 인터페이스계층으로 내려가며 메시지를 포장
    3. 메시지를 패킷으로 포장
        - 메시지는 작은 단위의 **패킷(packet)**으로 나뉘며 , 각 패킷에는 메시지의 일부와 제어정보(순서, 오류 등)가 포함된다.
    4. 제어 정보 추가(헤더, 수신 등)
        - 패킷에는 수신처 IP 주소, 출발지 IP주소, 포트번호, 체크섬 등의 정보가 포함된 헤더가 붙어있고, 이 정보는 목적지까지 패킷이 정확하게 도달하도록 하는 역할을 한다.
    5. 패킷을 LAN어탭터에 전달
        - 모든 포장이 완료되면, 운영체제는 이 패킷을 **네트워크 인터페이스 카드(NIC, LAN어탭터)** 로 전달한다.
    6. LAN어댑터가 전기 신호로 변환
        - LAN 어댑터는 디지털 정보를 **전기 신호**(유선 LAN) 또는 **무선 신호**(무선 LAN)로 변환한다.
    7. 신호를 LAN케이블 또는 무선으로 전송
        - 변환된 신호는 **LAN케이블(예: UTD 케이블)** 을 통해 스위치나 라우터를 거쳐 목적지 장치로 전달된다.
        - 이때, LAN의 구조에 따라 스위치가 패킷의 MAC주소를 기반으로 정확한 수신 장치로 전달

## 2. 케이블과 리피터, 허브 속으로 신호가 흘러간다.

- LAN 어댑터에서 중계기기로 신호가 넘어가는 과정
    1. LAN 어댑터(NIC)
        - LAN어댑터는 컴퓨터 내부 데이터를 패킷으로 포장한 뒤, 전기 신호로 변환해서 LAN 케이블에 보냅니다.
    2. LAN 케이블을 통해 신호 전송
        - 이 신호는 케이블을 따라 흐르며 이 케이블은 리피터 허브나 허브 같은 **중계 장치** 에 물리적으로 연결되어 있다.
        - 이때 중계 장치들은 패킷 안의 데이터 내용은 전혀 보지 않고, 오직 패킷의 헤더, 특히 **MAN 주소** 나 **IP 주소** 만 보고 어디로 보낼지 판단한다.
        - 이때 신호가 약해지거나 간섭이 있을 경우를 대비해 **리피터기능** 이 중요하게 작용
    3. 리피터 허브에서 신호 수신
        - 신호가 리피터 허브에 도달하면 LAN 전체에 신호가 흩어진다.
        - 들어온 전기 신호가 약해져 있다면 이를 **증폭(재생)**
        - 그리고 나서 연결된 모든 포트에 동일하게 신호를 **재전송**

- 리피터와 허브 : 같은 점 vs 다른 점
- 같은 점
    - 둘다 물리계층(OSI 1계층)에 속함
    - 데이터의 내용(MAC/IP 등)은 전혀 보지 않고, 오직 전기적 신호만 처리
    - 신호가 약해질 경우 재생(증폭)하여 다음 장치로 전달
- 차이 점
    - 허브 내부에 리피터 기능이 기본적으로 내장되어 있음
    
    | 항목 | 리피터 | 허브 |
    | --- | --- | --- |
    | 기본 역할 | 약해진 신호를 증폭 | 수신된 신호를 모든 포릍로 브로드캐스트 |
    | 포트 수대상 환경 | 두 네트워크 구간 연결
    (거리 확장 목적) | 여러 장치 연결
    (소형 LAN 구성) |
    | 신호 처리 | 단순 증폭 | 수신 후 전체 포트로 신호 복제 및 전송 |

## 3. 스위칭 허브가 패킷을 중계한다.

- OSI 2계층(데이터 링크 계층)
- MAC 주소 기반으로 통신
- 통신 과정 (PHY → MAC → 스위치 → 송신)
- 같은 네트워크 대역에서 통신
    1. 프레임 수신 (PHY → MAC )
        - 컴퓨터 A가 컴퓨터 B로 데이터를 보낼 때,
        - 컴퓨터 A의 LAN어댑터는 데이터를 이더넷 프레임으로 캡슐화 하여 전기 신호 형태로 내보낸다.
        - 이 전기 신호는 **LAN케이블** 을 통해 스위칭 허브로 전달된다.
    2. PHY가 전기 신호를 디지털 신호로 변환
        - 허브 안의 PHY 회로가 들어온 전기 신호를 0과 1의 디지털 신호로 변환
        - 이는 케이블에서 들어온 신호를 MAC계층이 이해할 수 있는 형태로 바꾸는 작업
    3. MAC 회로가 내용 분석 후 주소테이블에 등록
        - 변환된 디지털 신호는 **MAC회로**로 전달되어 프레임의 구성 정보를 분석한다.
        - 그 중 출발지 MAC주소를 확인해 이 프레임이 어느 포트에서 들어왔는지와 함께 **MAC 주소 테이블(CAM Table)** 에 등록합니다.
            - ex) “00:11:22:33:44:55 → 포트 2”
    4. 목적지 MAC 주소 확인
        - 이어서 프레임의 목적지 MAC 주소 를 읽고
            
            해당 MAC 주소가 MAC 테이블에 존재하는지 조회하며 어느 포트로 보내야 할지 판단.
            
    5. 포트 지정 전송(Unicast)
        - 해당 MAC 주소가 테이블에 있으면 → 그 포트에만 전송
        - 없다면 → 브로드캐스트(All Port)
        - 수신 포트 = 송신 포트 → 폐기 (수신과 송신이 동일하면 의미없는 루프가 생기기 때문에)
    6. 패킷 전송( 디지털 → 전기 신호)
        - 전송할 포트가 정해지면 그 쪽 포트의 PHY가 다시 디지털 데이터를 전기 신호로 바꿔 LAN 케이블로 내보낸다(컴퓨터 B가 받음)

| 구성 요소 | 설명 |
| --- | --- |
| **PHY (Physical Layer Device)** | 전기 신호 ↔ 디지털 신호 변환, MDI/MDI-X 연결 담당 |
| **MAC (Media Access Control)** | 이더넷 프레임 처리, 오류 검출, 주소 추출 |
| **Buffer Memory** | 각 포트별 큐 (보통 FIFO 구조), 프레임 일시 저장 |
| **Switching Fabric** | 내부 백플레인, 포트 간 전송 경로 처리 |
| **CAM Table** | MAC 주소와 포트 매핑 저장 (MAC Address Table) |

## 4. 라우터가 패킷을 중계한다.

- OSI 3계층(네트워크 계층)
- IP주소 기반으로 통신
- 다른 네트워크에 잇는 장치와 통신
- 통신 과정
    1. IP패킷 생성(Application → Transport → Network 계층)
        - 컴퓨터 A가 외부 사이트(ex: google.com)에 접속하려 하면
        - 브라우저 요청은 HTTP 요청 → TCP 세그먼트로 감싸짐
        - 그 TCP 세그먼트는 다시 IP패킷으로 캡슐화됨.
    2. 기본 게이트웨이로 패킷 전달
        - 컴퓨터 A는 라우팅 테이블에서 목적지 IP가 같은 서브넷인지 아닌지를 판단하여 네트워크 대역이 아니면, **기본 게이트웨이(라우터)** 로 패킷이 전송됨
        
        ```
        내 IP: 192.168.0.10  
        서브넷 마스크: 255.255.255.0  
        → 내 네트워크는 192.168.0.0/24
        
        목적지 IP: 142.250.206.14  
        → 다른 네트워크!
        ```
        
    3. 라우터가 라우팅 테이블 참조
        - 라우터는 수신된 IP패킷의 목적지 IP를 보고 자신이 가지고 있는 라우팅 테이블을 검색하여 목적지 IP가 어디에 속하는지 확인하고 **적절한 포트(똔ㄴ 다음 라우터)** 를 선택함.
            
            ```
            라우팅 테이블 예시:
            192.168.0.0/24 → Port 1  
            10.0.0.0/8 → Port 2  
            0.0.0.0/0 → Port 3 (인터넷)
            ```
            
    4. TTL 감소 및 포워딩
        - 라우터는 IP패킷의 TTL(Time To Live)값을 확인
            - 1감소시킴(라우터를 지날 때마다 줄어듦)
            - TTL=0이면 패킷폐기 + ICMP Time Exceeded 메시지 반환
        - TTL이 남아있으면 → 선택한 포트로 패킷 포워딩
    5. NAT 처리(필요 시)
        - 내부 IP(예: 192.168.0.10 = 사설 IP)는  공인 IP가 아니므로
            - 외부 인터넷에서는 인식 불가
            - **NAT(Network Address Translation)**으로 **공인 IP로 변환**
                
                후 인터넷으로 보냄
                
            - 라우터는 연결정보를 저장해서 응답이 돌아왔을 때 다시 올바른 사설 IP로 연결되도록 해줌(포트 매핑)
        
        ```
        내부 IP: 192.168.0.10:55667  
        → 변환 → 공인 IP: 203.0.113.45:60001
        ```
        
    6. 패킷 전송(다음 홉 or 최종 목적지)
        - 이제 목적지로 가는 다음 경로(다음 라우터 또는 목적지 서버) 에 IP패킷을 포워딩
        - 실제 전송은 다시 MAC 주소 기반 이더넷 프레임에 실어서 전송됨

| 구성 요소 | 설명 |
| --- | --- |
| **IP Packet Processor** | 수신한 IP 패킷의 헤더를 파싱하고 TTL 감소, 목적지 IP 주소 확인 등을 처리 |
| **Routing Table (FIB)** | 목적지 IP에 따라 다음 홉(next-hop) 및 출력 포트를 결정하는 테이블→ 보통 LPM(Longest Prefix Match) 방식 사용 |
| **ARP Table** | IP 주소 ↔ MAC 주소 매핑 저장, 다음 홉 MAC 주소를 찾을 때 사용 |
| **NAT Table (필요 시)** | 사설 IP ↔ 공인 IP 주소 매핑 저장, 포트 정보 포함(PAT 기능) |
| **Buffer Memory** | 포트별 전송 큐 또는 처리 대기 공간, 혼잡 제어에 사용 |
| **Forwarding Engine** | 라우팅 테이블/ARP 테이블을 참고하여 실제 패킷 전송 경로를 설정하는 회로/로직 |
| **Control Plane (CPU)** | 라우팅 프로토콜 처리(RIP, OSPF 등), 테이블 업데이트, 관리 기능 담당 |
| **Data Plane (Fast Path)** | 실시간으로 패킷 포워딩만 담당 (빠르게 처리, 대부분 하드웨어 기반) |
