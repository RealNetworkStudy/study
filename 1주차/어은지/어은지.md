- **1주차 “브라우저에 url을 입력하면, 브라우저에서 url(웹 서버)에 요청을 보낸다.**
    1. **동작 흐름에 따라서 조사하기**
        1. **HTTP request 메시지를 작성한다.**
        2. **웹 서버(url)의 IP주소를 DNS서버에 조회한다.**
        3. **프로토콜 스택에 메시지 송신을 의뢰한다.**
    2. **관련 키워드**
        1. **IP주소**
        2. **DNS**
        3. **Socket**
        4. **프로토콜 스택**
    
    ---
    
    - 통신 흐름
        - **URL 파싱**
            - **Parsing**: URL을 구성하는 요소들을 분석, 필요한 정보 추출, 특정 규칙에 따라 문자열을 분석, 요소 분리. 주로 프로토콜, 도메인, 포트, 경로, 쿼리 문자열 등 추출
            - 사용자가 주소창에 특정 URL을 입력하게 되면 **브라우저는 먼저 URL의 구조를 해석**하는 과정을 진행한다.
            - **해당 문자열이 URL인지 일반 검색을 위한 문자열인지 확인**하고, **통신을 위한 프로토콜은 어떤 것을 사용하는 지, 도메인은 무엇인지 등을 파싱**한다.
        
        ---
        
        - **DNS Lookup**
            - **DNS**: Domain Name System→ 예를 들어 google.com(도메인 이름)을 142.250.190.78(IP주소)로 변환하는 시스템.
            - **URL을 파싱한 뒤 도메인에 해당하는 IP를 찾는 과정.**
            - **캐시조회, DNS쿼리 순 진행**
                1. **캐시조회**
                : 브라우저는 DNS에 쿼리하기 전에 **이전에 요청한 적이 있는지** 다음과 같은 순서로 캐시를 조회한다.
                : 이 때 **쿼리(Query)는 데이터를 요청하거나 검색하는 명령**을 의미한다. URL의 쿼리는 ?뒤의 키-값 쌍을 전달하는 방식을 의미한다.
                    - 웹 브라우저 캐시
                    : 웹 브라우저는 서버에 요청한 정보를 일정 시간동안 내부 디스크에 기록하고 있다. 해당 디스크 내에는 리소스(html, css, img)와 IP주소 등이 있다.
                    - OS의 hosts 파일
                    : 도메인과  IP가 매핑되어 있는단순 텍스트 파일. 보안 프로그램에 의해 대부분 수정 불가
                    - OS의 DNS 캐시
                    : 윈도우는 터미널에서 ipconfig/ displaydns을 치면 조회할 수 있다.
                    - 라우터의 DNS 캐시
                    : 로컬 네트워크에 연결된 라우터의 DNS 캐시를 찾는다.
                    - ISP의 DNS 캐시
                    : ISP(Internet Service Provider)는 인터넷 서비스 제공자로 통신사가 있다.
                2. **DNS 쿼리**
                : 캐시가 없는 경우 **브라우저가 로컬 DNS서버에 도메인 정보(FQDN)을 전달**하여  IP 요청.
                -FQDN: Fully Qualified Domain Name 완전히 지정된 도메인 이름으로 인터넷에서 특정 호스트나 서버를 정확히 식별할 수 있도록 도와주는 전체 도메인 이름.
                Host Name→ www, mail, ftp
                Domain Name→ example.com, google.com
                **FQDN=Host Name + Domain Name = www+google.com = www.google.com**
                
                : 로컬 DNS 서버는 웹 브라우저로부터 FQDN을 받은 뒤, Root 도메인부터 Third-Level 도메인 순으로 각각 맞는 IP 요청.
                : 각 DNS 네임 서버는 도메인에 매핑된 IP주소가 저장되어 있는지 찾고, 없다면 다음 레벨의 도메인 서버에 대한 정보를 로컬 DNS 서버에게 반환.
                : 로컬 DNS 서버는 전달받은 다음 레벨의 DNS 네임서버에게 질의를 해가며 최종 IP주소를 전달받는다.
                
                **Recursive Query**
                = 브라우저 
                → 로컬 DNS 서버 
                → (Root Domain, Top-level Domain, Second-level Domain. Third-level Domain)의 DNS 네임 서버
                → 로컬 DNS 서버
                **⇒ 최종 IP 주소 반환.
                ⇒로컬 DNS 서버 캐시에 업데이트
                ⇒브라우저에 IP 반환.\**
        
        ---
        
        - **IP 라우팅을 통해 목적지까지 최적 경로 찾기**
        : 라우터의 라우팅 테이블을 통해 해당 서버 네트워크 게이트웨이까지 최적의 전송 경로를 찾는다. IP주소를 DNS를 통해 알아내고, 경로를 찾는 상황.
        
        ---
        
        - **ARP를 통해 해당 서버의 MAC 주소 알아내기**
        : 목적지 서버와 통신하기 위해 **ARP(Adress Resolution Protocol) 프로토콜**을 사용하여 **논리적인 IP주소를 물리적인 MAC 주소로 변환. MAC 주소는 물리적으로 장치가 연결되는 네트워크 인터페이스 카드에 할당.**
        
        - 네트워크에서 데이터를 전송할 때 IP 주소만으로는 물리적인 장치를 찾을 수 없기 때문에, **ARP는 IP 주소를 MAC 주소로 변환해주어 원활한 통신을 가능하게 함.**
        
        **: 웹브라우저가 있는 서버는 ARP 요청 패킷을 생성해서 대상 호스트가 존재하는 네트워크 내 브로드 캐스트 방식으로 요청.**
        
        - **브로드캐스트란** 네트워크에서 **모든 장치에** 동시에 메시지를 보내는 방식을 의미.
        
        : 해당 네트워크 내의 모든 호스트와 라우터들은 ARP요청을 수락하고, **요청 대상자인 호스트만 IP주소와 MAC주소를 반환.**
        
        ---
        
        - **TCP socket 연결**
        : 목적지 서버의 MAC 주소와 물리적인 전송 경로까지 알아냈으므로, 브라우저는 서버와 통신을 위해 **TCP 소켓 연결**을 진행.
        
        - **TCP 소켓 연결**
        : 네트워크 상에서 두 컴퓨터 간의 안정적인 통신을 설정하는 과정. 소켓을 사용하여 데이터를 주고받을 때 손실 없는 데이터 전송을 보장.
        : 전송된 데이터의 순서와 무결성 보장.
        : 패킷 손실 방지를 위해 재전송 수행.
        
        **- TCP(Transmission Control Protocol):** 연결 지향적이고 신뢰성 있는 통신을 제공하는 프로토콜.
        
        **- Socket:** 네트워크에서 데이터 통신을 할 수 있는 양 끝단. 소켓은 IP주소, 포트 번호로 식별.
        
        : TCP 소켓 연결은 TCP 3-way handshake를 통해 진행. HTTPS 프로토콜 사용시 SSL/TLS Handshake 수행.
        
        -TCP 3-way handshake : 요청(요청 보냄)→수신(수신함, ACK 응답 요청)→패킷수신(서버에 ACK패킷 전송) ⇒ 논리적 연결 완료, Server status: ESTABLISHED
        
        ---
        
        - **HTTP(s) 프로토콜을 통해 통신**
        : TCP 연결까지 완료된 이후 **브라우저는 HTTP 요청 메시지를 생성**하고 **목적지 서버로** 전달하는 과정 진행.
        
        - http 요청 메시지: 클라이언트(브라우저,앱)가 **서버에 특정 리소스를 요청**할 때 사용하는 메시지. Hypertext Transfer Protocol을 통해 서버와 클라이언트 간 통신 관리.
        
        : 웹 브라우저가 소켓 라이브러리를 통해 HTTP 메시지 전송, **프로토콜 스택**이라는 **OS에 내장된 네트워크 제어용 소프트웨어**에 전달.
        
        : **프로토콜 스택은 HTTP 메시지에 제어 정보를 덧붙여서 패킷으로 생성**한 뒤, ****네트워크 어댑터(LAN/ WIFI 어댑터)를 통해 패킷을 전기 신호 또는 **무선 신호로 변환하여 송추**
        
        : 네트워크 어댑터를 통해 송출된 패킷은 공유기/ 스위칭 허브/ 모뎀 등을 통해서 **ISP의 라우터**로 전달된 뒤 목적지 서버까지 물리적인 전송.
        
        - ISP 라우터: Internet Service Provider가 제공하는 라우터. 
        
        : 도착지 서버에 패킷 도착시 **서버의 프로토콜 스택이 패킷을 추출**하여 메시지 복원, 브라우저에게 전달.
        
        : 웹 서버의 애플리케이션은 요청에 대한 HTTP 응답 메시지를 생성한 뒤 동일한 방식으로 웹 브라우저에게 전달.
        
        ---
        
        - **브라우저 랜더링 및 통신 종료**
        : 웹 브라우저는 전달받은 HTTP 응답 메시지를 해석, 받은 데이터를 브라우저 화면에 그리는 렌더링 수행.
        : 모든 요청 및 응답 완료시 HTTP(s) 연결 종료, 통신 마무리.
        
        ---
        
        # 요약
        
        1. 주소창에 URL을 입력하면 웹 브라우저는 URL을 해석 하고, DNS Lookup을 통해 도메인에 해당하는 IP 주소를 찾습니다.
        2. DNS Lookup은 먼저 브라우저 캐시 , OS의 호스트파일, OS DNS 캐시, 공유기/ISP 에 설치된 로컬 DNS 서버의 캐시 순으로 캐싱되어 있는 IP를 찾은 뒤 있다면 바로 브라우저에 반환하고 없다면 로컬 DNS 서버에게 질의합니다.
        3. 로컬 DNS 서버는 Root 도메인부터 순차적으로 IP주소를 질의하는 Recursive Query를 수행해서 IP주소를 찾은 뒤 캐시에 저장 및 브라우저에 반환 합니다.
        4. IP 주소를 찾은 이후에는 IP 라우팅을 통해 목적지 까지의 최적의 전송 경로를 알아내고, 실질적인 통신을 위해 ARP 프로토콜을 사용해 목적지 서버의 물리 주소인 MAC주소를 알아내는 과정이 수행됩니다.
        5. 이렇게 전송 경로와 MAC 주소까지 알아낸 뒤에는 TCP 3-way handshake 와 SSL/TLS handshake를 통해 TCP 소켓을 연결하고, HTTP 메시지를 생성해서 웹 서버에게 요청합니다.
        6. 이 때 요청한 HTTP 메시지는 프로토콜 스택에 의해 패킷으로 변환되고 네트워크 어댑터, 공유기, 모뎀, 라우터 등의 물리 장비를 통해 목적지 서버로 실제 물리적인 전송을 수행합니다.
        7. 목적지 서버의 프로토콜 스택은 전달받은 전기/무선 신호를 패킷으로 변환하고, 패킷을 HTTP 메시지로 복원한 뒤 웹 서버 애플리케이션으로 전달합니다.
        8. 웹 서버의 애플리케이션은 요청을 받은 뒤 그에 해당하는 HTTP 응답 메시지를 동일한 방법을 통해 클라이언트에게 반환합니다.
        
        ---
        
        출처1 : [https://velog.io/@jonghne/웹브라우저-주소창에-URL을-입력했을-때-통신-흐름](https://velog.io/@jonghne/)]
        출처2 : chatgpt.com
